DROP DATABASE IF EXISTS METODOLOGIC;
CREATE DATABASE METODOLOGIC;
USE METODOLOGIC;

CREATE TABLE PROFESSORES (
    PRF_ID INTEGER AUTO_INCREMENT,
    USR_NOME VARCHAR(255),
    USR_EMAIL VARCHAR(255),
    USR_SENHA VARCHAR(255),
    USR_PONTOS INTEGER,
    USR_NIVEL INTEGER,
    FK_JORNADA_JRN_ID INTEGER,
    PRIMARY KEY (PRF_ID)
);

CREATE TABLE ALUNOS (
    ALN_ID INTEGER AUTO_INCREMENT,
    USR_NOME VARCHAR(255),
    USR_EMAIL VARCHAR(255),
    USR_SENHA VARCHAR(255),
    USR_PONTOS INTEGER,
    USR_NIVEL INTEGER,
    FK_JORNADA_JRN_ID INTEGER,
    PRIMARY KEY (ALN_ID)
);

CREATE TABLE TURMAS (
    TRM_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
    FK_PROFESSORES_PRF_ID INTEGER
);

CREATE TABLE TAREFAS (
    TRF_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
    TRF_DATA_POSTAGEM DATE,
    TRF_DATA_ENTREGA DATE,
    FK_TURMAS_TRM_ID INTEGER,
    FK_PROFESSORES_PRF_ID INTEGER
);

CREATE TABLE QUESTOES (
    QST_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
    QST_NIVEL INTEGER,
    QST_PONTOS INTEGER,
    QST_TEMA VARCHAR(255),
    QST_TIPO VARCHAR(255),
    FK_JORNADA_JRN_ID INTEGER
);

CREATE TABLE JORNADA (
    JRN_ID INTEGER PRIMARY KEY AUTO_INCREMENT
);

CREATE TABLE NARRATIVA (
    NRT_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
    FK_JORNADA_JRN_ID INTEGER
);

CREATE TABLE CONTEUDO (
    CNT_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
    CNT_TITULO VARCHAR(255),
    CNT_PALAVRAS_CHAVES VARCHAR(255),
    CNT_DEFINICAO VARCHAR(255),
    CNT_ETAPA_PESQUISA VARCHAR(255)
);

CREATE TABLE COMPOE (
    FK_QUESTOES_QST_ID INTEGER,
    FK_TAREFAS_TRF_ID INTEGER
);

CREATE TABLE ALUNOS_TURMAS (
    FK_ALUNOS_ALN_ID INTEGER,
    FK_TURMAS_TRM_ID INTEGER
);

CREATE TABLE ALUNOS_TAREFAS (
    FK_ALUNOS_ALN_ID INTEGER,
    FK_TAREFAS_TRF_ID INTEGER,
    ALT_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
    ALT_NOTA FLOAT,
    ALT_DATA DATE
);

CREATE TABLE QUESTAO_CONTEUDO (
    FK_CONTEUDO_CNT_ID INTEGER,
    FK_QUESTOES_QST_ID INTEGER
);

ALTER TABLE PROFESSORES ADD CONSTRAINT FK_PROFESSORES_2
    FOREIGN KEY (FK_JORNADA_JRN_ID)
    REFERENCES JORNADA (JRN_ID)
    ON DELETE CASCADE;

ALTER TABLE ALUNOS ADD CONSTRAINT FK_ALUNOS_2
    FOREIGN KEY (FK_JORNADA_JRN_ID)
    REFERENCES JORNADA (JRN_ID)
    ON DELETE CASCADE;

ALTER TABLE TURMAS ADD CONSTRAINT FK_TURMAS_2
    FOREIGN KEY (FK_PROFESSORES_PRF_ID)
    REFERENCES PROFESSORES (PRF_ID)
    ON DELETE CASCADE;

ALTER TABLE TAREFAS ADD CONSTRAINT FK_TAREFAS_2
    FOREIGN KEY (FK_TURMAS_TRM_ID)
    REFERENCES TURMAS (TRM_ID)
    ON DELETE CASCADE;

ALTER TABLE TAREFAS ADD CONSTRAINT FK_TAREFAS_3
    FOREIGN KEY (FK_PROFESSORES_PRF_ID)
    REFERENCES PROFESSORES (PRF_ID)
    ON DELETE CASCADE;

ALTER TABLE QUESTOES ADD CONSTRAINT FK_QUESTOES_2
    FOREIGN KEY (FK_JORNADA_JRN_ID)
    REFERENCES JORNADA (JRN_ID)
    ON DELETE RESTRICT;

ALTER TABLE NARRATIVA ADD CONSTRAINT FK_NARRATIVA_2
    FOREIGN KEY (FK_JORNADA_JRN_ID)
    REFERENCES JORNADA (JRN_ID)
    ON DELETE CASCADE;

ALTER TABLE COMPOE ADD CONSTRAINT FK_COMPOE_1
    FOREIGN KEY (FK_QUESTOES_QST_ID)
    REFERENCES QUESTOES (QST_ID)
    ON DELETE RESTRICT;

ALTER TABLE COMPOE ADD CONSTRAINT FK_COMPOE_2
    FOREIGN KEY (FK_TAREFAS_TRF_ID)
    REFERENCES TAREFAS (TRF_ID)
    ON DELETE SET NULL;

ALTER TABLE ALUNOS_TURMAS ADD CONSTRAINT FK_ALUNOS_TURMAS_1
    FOREIGN KEY (FK_ALUNOS_ALN_ID)
    REFERENCES ALUNOS (ALN_ID)
    ON DELETE RESTRICT;

ALTER TABLE ALUNOS_TURMAS ADD CONSTRAINT FK_ALUNOS_TURMAS_2
    FOREIGN KEY (FK_TURMAS_TRM_ID)
    REFERENCES TURMAS (TRM_ID)
    ON DELETE SET NULL;

ALTER TABLE ALUNOS_TAREFAS ADD CONSTRAINT FK_ALUNOS_TAREFAS_2
    FOREIGN KEY (FK_ALUNOS_ALN_ID)
    REFERENCES ALUNOS (ALN_ID)
    ON DELETE SET NULL;

ALTER TABLE ALUNOS_TAREFAS ADD CONSTRAINT FK_ALUNOS_TAREFAS_3
    FOREIGN KEY (FK_TAREFAS_TRF_ID)
    REFERENCES TAREFAS (TRF_ID)
    ON DELETE SET NULL;

ALTER TABLE QUESTAO_CONTEUDO ADD CONSTRAINT FK_QUESTAO_CONTEUDO_1
    FOREIGN KEY (FK_CONTEUDO_CNT_ID)
    REFERENCES CONTEUDO (CNT_ID)
    ON DELETE RESTRICT;

ALTER TABLE QUESTAO_CONTEUDO ADD CONSTRAINT FK_QUESTAO_CONTEUDO_2
    FOREIGN KEY (FK_QUESTOES_QST_ID)
    REFERENCES QUESTOES (QST_ID)
    ON DELETE SET NULL;
